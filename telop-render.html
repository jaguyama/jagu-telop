<!DOCTYPE html>
<html>
    <head>
        <title>テロップ表示用</title>
        <script>
            const LOCAL_STRAGE_KEY="jaguyama-telop"
            function getUrlQueries() {
                var queryStr = window.location.search.slice(1);  // 文頭?を除外
                queries = {};
                // クエリがない場合は空のオブジェクトを返す
                if (!queryStr) {
                    return queries;
                }
    
                // クエリ文字列を & で分割して処理
                queryStr.split('&').forEach(function(queryStr) {
                    // = で分割してkey,valueをオブジェクトに格納
                    var queryArr = queryStr.split('=');
                    queries[queryArr[0]] = queryArr[1];
                });
  
                return queries;
            }

            
            function  telopInit(e){
                const queries=getUrlQueries();
                let telopData=JSON.parse(localStorage.getItem(LOCAL_STRAGE_KEY));
                let key=queries["key"];
                
                let text=telopData.find((d)=>(d.key==key))?telopData.find((d)=>(d.key==key)).text:`key"${queries["key"]}"を確認してください`;
                document.getElementById("telop").textContent=text;
            }

            function  telopUpdate(e){
                const queries=getUrlQueries();
                let telopData=JSON.parse(localStorage.getItem(LOCAL_STRAGE_KEY));
                let key=queries["key"];
                
                let text=telopData.find((d)=>(d.key==key))?telopData.find((d)=>(d.key==key)).text:`key"${queries["key"]}"を確認してください`;
                
                if(document.getElementById("telop").textContent!=text){
                    document.getElementById("telop").textContent=text;
                    console.log(text);
                };

            }
            
            window.onload=telopInit;
            window.onstorage=telopUpdate;
        </script>
    </head>
    <body>
        <div id="telop">

        </div>
    </body>
</html>